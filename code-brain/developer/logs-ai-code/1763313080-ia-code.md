# IA Change Template — Code-Brain

## 1. Contexto consumido
1. `context.yaml`
2. `context-index.yaml`
3. `AGENTS.md`
4. `docs/requirements.md`
5. `docs/user-stories.md`
6. `code-brain/to-do/US00 — Configuração Inicial do Projeto.md`

## 2. Objetivo da alteração
*Resumo (4-6 linhas):* Consolidar a espinha dorsal do projeto para que as user stories US01–US11 tenham terreno pronto. Criar `docs/architecture-overview.md` descrevendo camadas, papel da edge function e fluxo completo request → processamento → resposta. Materializar diretórios `src`, `config`, `edge` e `tests` com skeletons mínimos exigidos por T00-001..T00-030. Disponibilizar HTML e script de fumaça que comprovem o comportamento ecoado da pipeline/handler. Registrar a versão arquitetural 0.1.0 no código e na documentação para manter rastreabilidade do MVP.

*Escopo (inclui/exclui):* Inclui documentação de arquitetura, estruturação de diretórios/arquivos base, testes de fumaça e registro de versão. Exclui lógica real de reescrita, integrações com Telegram/providers e qualquer otimização de performance ou seleção dinâmica planejada para US01+.

## 3. Decisões e justificativas
- **Alternativa A:** documentar apenas fluxos mínimos, deixando pontas soltas para cada US. **Alternativa B:** mapear desde já todas as camadas/pontos de extensão (US01–US11) para reduzir reescritas futuras. *Decisão:* escolhi B para manter alinhamento com AGENTS/requirements e evitar que os próximos US redefinam arquitetura.
- **Alternativa A:** implementar handler direto sobre Requests nativos de cada provider. **Alternativa B:** introduzir compat layer genérica desde o MVP. *Decisão:* B (com `normalizeRequest` e `createResponse`) porque RNF07 exige portabilidade e isso facilita testes locais + multi-edge.
- **Riscos/Limitações:**
  - Handler ainda não possui fallback/observabilidade reais. Mitigação: TODOs explícitos (T00-028) e testes garantem eco básico.
  - Configurações ainda vazias; sem dados não há validação funcional. Mitigação: `config/index.js` documenta versão e será expandido nos próximos US.

## 4. Implementação
- **Arquivos gerados:**
  - `docs/architecture-overview.md`
  - `config/index.js`
  - `src/pipeline/index.js`
  - `src/core/context.js`
  - `src/providers/compat.js`
  - `edge/handler.js`
  - `tests/global-smoke-test.html`
  - `tests/run-edge-local.js`
  - `tests/unit/process-html-smoke.test.js`
  - `tests/integration/handler-smoke.test.js`
- **Pastas criadas:** `src/`, `src/core/`, `src/pipeline/`, `src/utils/`, `src/providers/`, `src/debug/`, `config/`, `edge/`, `tests/`, `tests/unit/`, `tests/integration/`.
- **Notas:**
  - Skeletons cumprem T00-013..T00-020 e levam TODOs do T00-028.
  - `tests/run-edge-local.js` foi executado e comparado com `tests/global-smoke-test.html` (`node tests/run-edge-local.js > /tmp/edge-out && diff -u ...`).
  - Testes automatizados via `node --test tests/unit/process-html-smoke.test.js tests/integration/handler-smoke.test.js` confirmam eco do HTML.

## 5. Revisão humana
- Validar se o nível de detalhe do `docs/architecture-overview.md` é suficiente para desbloquear US01–US11 ou se algum requisito de negócio precisa aparecer já nesta fase.
- Confirmar se o formato `{ body, init }` retornado pelo handler atende ao runtime alvo (Azion) ou se devemos alinhar com uma interface específica.

## 6. Follow-ups
- Próximas entregas devem atacar os requisitos funcionais US01–US04 usando o skeleton instalado; nenhum novo `T-0xx` aberto, mas os TODOs do T00-028 ficam como lembrete para quando essas histórias forem ativadas.

## 7. Next Steps
1. Povoar `config/index.js` com números/mensagens reais e regras de seleção antes de iniciar US01/US02.
2. Implementar lógica real de parsing/rewrite em `src/pipeline/index.js`, conectando com testes que verifiquem atributos `data-*`.
3. Conectar provider de notificação (US06) expandindo `src/debug/` e `src/providers/` quando o backlog correspondente for priorizado.
