# US06 — Notificação via Telegram

## 1. Objetivo
Enviar uma notificação para um canal/usuário no Telegram quando ocorrer uma falha que acione o fallback (US05). A notificação não pode bloquear a entrega do HTML e deve ser considerada best-effort.

## 2. Estrutura da Mensagem
Cada mensagem deve conter:
- **timestamp** em ISO string.
- **página afetada** (URL do request quando disponível).
- **descrição resumida do erro** (mensagem + stage).

## 3. Momento do disparo
A notificação é disparada **após** a decisão de fallback no handler da Edge. Se `shouldUseFallback(results)` for `true`, preparamos o payload e tentamos enviar a mensagem.

## 4. Configuração
- `config/index.js` possui `telegramBotToken` e `telegramChatId` (podem ficar vazios em dev). 
- Opcionalmente, token e chat id podem ser lidos de variáveis de ambiente `TELEGRAM_BOT_TOKEN` e `TELEGRAM_CHAT_ID`.

## 5. Fluxo Resumido
1. Pipeline executa e coleta `results`.
2. Fallback decide entregar HTML original quando necessário.
3. Se fallback ocorreu, monta-se um payload com timestamp, URL e erros.
4. `notifyFailureViaTelegram` cria a mensagem e chama a Bot API (`sendMessage`).
5. Qualquer erro do Telegram é logado (via resultado retornado), mas não interrompe a resposta.

## 6. Falha no Telegram
Se a chamada ao Telegram falhar (rede, HTTP, payload inválido), o erro é tratado e ignorado. A Edge Function já terá decidido o fallback e retornará o HTML original normalmente.
